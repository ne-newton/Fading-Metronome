<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metronome</title>
</head>
<body>
    <h1>The Fading Metronome</h1>
    <label for="tempo">Tempo (BPM): </label>
    <input type="number" id="tempo" value="120">
    <button id="start-stop">Start</button>
    <audio id="click-sound" src="click.mp3" preload="auto"></audio>

    <script>
        const clickSound = document.getElementById('click-sound');
        const startStopButton = document.getElementById('start-stop');
        const tempoInput = document.getElementById('tempo');

        let intervalId;
        let beatCount = 0;
        let currentModulo = 1;
        let phaseCount = 0;

        startStopButton.addEventListener('click', () => {
            if (intervalId) {
                // Stop the metronome
                clearInterval(intervalId);
                intervalId = null;
                startStopButton.textContent = 'Start';
            } else {
                // Start the metronome
                const bpm = parseInt(tempoInput.value);
                const interval = 60000 / bpm;

                beatCount = 0;
                currentModulo = 1;
                phaseCount = 0;

                intervalId = setInterval(() => {
                    if (beatCount % currentModulo === 0) {
                        clickSound.play();
                    }
                    
                    beatCount++;
                    
                    if (beatCount >= 16) {
                        phaseCount++;
                        beatCount = 0;
                        if (phaseCount === 1) currentModulo = 2;
                        else if (phaseCount >= 2 && phaseCount < 4) currentModulo = 4;
                        else if (phaseCount >= 4 && phaseCount < 8) currentModulo = 8;
                        else if (phaseCount >= 8) currentModulo = 16;
                    }
                }, interval);

                startStopButton.textContent = 'Stop';
            }
        });
    </script>
</body>
</html>
